name: Typecheck with Comment

on:
  pull_request:
    paths:
      - '**.ts'
      - '**.svelte'
      - '**.json'
      - '.github/workflows/typecheck-comment.yml'
  workflow_dispatch:

jobs:
  typecheck:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: oven-sh/setup-bun@v1
      
      - name: Install dependencies
        run: bun install --frozen-lockfile
      
      - name: Run typecheck with GitHub comment
        id: typecheck
        run: |
          bash scripts/typecheck-with-comment.sh \
            --post-comment \
            --pr-number ${{ github.event.pull_request.number }} \
            --token ${{ secrets.GITHUB_TOKEN }}
        continue-on-error: true
      
      - name: Check typecheck status
        if: steps.typecheck.outcome == 'failure'
        run: echo "⚠️  Typecheck failed but comment was posted" && exit 1
